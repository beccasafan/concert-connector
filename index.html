<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Harry Styles Live On Tour - Concert Connector</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css'>
<style>
html,
body,
.full-bg-img {
  height: 100%;
}
.full-bg-img {
  background: url('https://static.tumblr.com/wvzujvn/HKJop8naw/hs_cover.jpg') no-repeat center center fixed;
  background-size: cover;
  position: fixed;
  overflow: hidden;
  left: 0;
  top: 0;
  width: 100%;
  z-index: -1;
}
#title h3 {
  color: white;
}
#concert-selected {
  border: 1px solid transparent;
}
.card {
  position: relative;
}
.card img {
  width: 100%;
  border-radius: .25rem 0 0 .25rem;
}
.card .card-subtitle {
  margin-bottom: 0.75rem;
}
.card .concert-meta {
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.footer {
  color: white;
}
</style>
  
</head>

<body>
  <div class="full-bg-img flex-center"></div>
<div id="concert-connector" class="container">
 <div id="title" class="text-center">
  <h3 class="my-3">Harry Styles Live On Tour - Concert Connector</h3>
 </div>
 <select id="concerts-list" class="form-control" data-bind="options: concerts, optionsText: 'title', value: selectedConcertIndex, optionsValue: 'index', optionsCaption: 'Select a concert...'">
	</select>
 <div id="concert-selected" data-bind="if: selectedConcert">
  <!-- ko with: selectedConcert -->
  <div class="card my-3">
   <div class="row no-gutters">
    <div class="col-sm-12 col-md-8">
     <div class="concert-meta text-center">
      <h3 class="card-title" data-bind="text: venue">	</h3>
      <h4 class="card-subtitle" data-bind="text: location"></h4>
      <h5 class="card-subtitle" data-bind="text: date"></h5>
     </div>
    </div>
    <div class="col-sm-12 col-md-4">
     <img data-bind="attr: { src: image }" />
     <div class="google-maps--view card-footer text-center">
      <a target="_blank" data-bind="attr: { href: $parent.getGoogleMapsLink($data) }">View in Google Maps</a>
     </div>
    </div>
   </div>
  </div>
  <div class="card mt-3">
   <div class="card-block">
    <div class="col-sm-12">
     <div class="pb-3"><a data-bind="attr: { href: $parent.getGoogleFormsLink($data) }">Add your name</a></div>
     
     <div>
      <table class="table table-striped">
       <thead>
        <tr>
         <th style="width: 50%;">Name</th>
         <th>Section</th>
        </tr>
       </thead>
       <!-- ko if: people -->
       <tbody data-bind="foreach: people" class="text-left">
        <tr>
         <td data-bind="text: person"></td>
         <td data-bind="text: section"></td>
        </tr>
       </tbody>
       <!-- /ko -->
       <!-- ko ifnot: people -->
       <tbody>
        <tr>
         <td colspan="2">Nobody has signed up yet.</td>
        </tr>
       </tbody>
       <!-- /ko -->
      </table>
     </div>
    </div>
   </div>
  </div>
  <!-- /ko -->
 </div>
 <p class="text-center footer">Background image from <a href="http://hstyles.co.uk" class="footer">http://hstyles.co.uk</a></p>
</div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js'></script>

    <script>
    var ConcertConnector = (function () {
    function ConcertConnector() {
        var _this = this;
        this.tableId = "1vYcrMlKiTH0wRxO_tA19jtD0X6Uy2a9b4OvwKdNJ";
        this.apiKey = "AIzaSyCc-3LbhBwF_eRD6d8cZ-iqLtKM2E2V8TY";
        this.concerts = ko.observableArray();
        this.selectedConcertIndex = ko.observable();
        this.selectedConcert = ko.computed(function () { return _this.selectedConcertIndex() != null ? _this.getConcert(_this.selectedConcertIndex()) : null; });
        $(function () {
            $.get(_this.getTableUrl()).done(function (data) { return _this.loadData(data); });
        });
    }
    ConcertConnector.prototype.getTableUrl = function () {
        return "https://www.googleapis.com/fusiontables/v2/query?sql=SELECT * FROM " + this.tableId + " ORDER BY Index&key=" + this.apiKey;
    };
    ConcertConnector.prototype.loadData = function (data) {
        this.concerts(_.map(data.rows, function (r) {
            return {
                index: r[0],
                date: r[1],
                venue: r[2],
                location: r[3],
                latLng: r[4],
                title: r[6],
                image: r[5],
                people: r[7].length <= 0 ? null : _.map(r[7].split("|"), function (p) {
                    if (p.length > 0) {
                        var person = p.split(":");
                        return {
                            person: person[0],
                            section: person[1] || null
                        };
                    }
                    else {
                        return null;
                    }
                })
            };
        }));
        this.selectedConcertIndex(1);
    };
    ConcertConnector.prototype.showConcert = function (index) {
        var concert = this.getConcert(index);
        ;
        console.log(index, concert);
    };
    ConcertConnector.prototype.getConcert = function (index) {
        return _.find(this.concerts(), function (c) { return index === c.index; });
    };
    ConcertConnector.prototype.getGoogleMapsLink = function (concert) {
        return "https://maps.google.com/maps/place/" + concert.venue + ", " + concert.location + "/@" + concert.latLng;
    };
    ConcertConnector.prototype.getGoogleFormsLink = function(concert) {
        return "https://docs.google.com/forms/d/e/1FAIpQLSdROr7C-2jJ6-xjZodDw6ykHxPd97g2wiqongSAWZFhoPDHCA/viewform?usp=pp_url&entry.573869022=" + concert.title;
    };
    return ConcertConnector;
}());
var concertConnector = new ConcertConnector();
ko.applyBindings(concertConnector);
</script>

</body>
</html>
